function cov_sgsuy50g4(){var path="/Users/federicolacabaratz/bootcamp/collab/skylab-bootcamp-202001/staff/federico-lacabaratz/share-my-spot/share-my-spot-api/logic/authenticate-user.js";var hash="a976fe2337e6b2720df4874bc6fd2384f52e07be";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/federicolacabaratz/bootcamp/collab/skylab-bootcamp-202001/staff/federico-lacabaratz/share-my-spot/share-my-spot-api/logic/authenticate-user.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:51}},"1":{start:{line:2,column:29},end:{line:2,column:58}},"2":{start:{line:3,column:28},end:{line:3,column:59}},"3":{start:{line:4,column:20},end:{line:4,column:39}},"4":{start:{line:19,column:0},end:{line:39,column:1}},"5":{start:{line:20,column:4},end:{line:20,column:35}},"6":{start:{line:21,column:4},end:{line:21,column:25}},"7":{start:{line:22,column:4},end:{line:22,column:41}},"8":{start:{line:24,column:4},end:{line:38,column:8}},"9":{start:{line:25,column:21},end:{line:25,column:50}},"10":{start:{line:27,column:8},end:{line:27,column:65}},"11":{start:{line:27,column:19},end:{line:27,column:65}},"12":{start:{line:29,column:30},end:{line:29,column:68}},"13":{start:{line:31,column:8},end:{line:31,column:74}},"14":{start:{line:31,column:28},end:{line:31,column:74}},"15":{start:{line:33,column:8},end:{line:33,column:43}},"16":{start:{line:35,column:23},end:{line:35,column:40}},"17":{start:{line:37,column:8},end:{line:37,column:17}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:19,column:17},end:{line:19,column:18}},loc:{start:{line:19,column:38},end:{line:39,column:1}},line:19},"1":{name:"(anonymous_1)",decl:{start:{line:24,column:12},end:{line:24,column:13}},loc:{start:{line:24,column:23},end:{line:38,column:5}},line:24}},branchMap:{"0":{loc:{start:{line:27,column:8},end:{line:27,column:65}},type:"if",locations:[{start:{line:27,column:8},end:{line:27,column:65}},{start:{line:27,column:8},end:{line:27,column:65}}],line:27},"1":{loc:{start:{line:31,column:8},end:{line:31,column:74}},type:"if",locations:[{start:{line:31,column:8},end:{line:31,column:74}},{start:{line:31,column:8},end:{line:31,column:74}}],line:31}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"a976fe2337e6b2720df4874bc6fd2384f52e07be"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_sgsuy50g4=function(){return actualCoverage;};return actualCoverage;}cov_sgsuy50g4();const{validate}=(cov_sgsuy50g4().s[0]++,require('share-my-spot-utils'));const{models:{User}}=(cov_sgsuy50g4().s[1]++,require('share-my-spot-data'));const{NotAllowedError}=(cov_sgsuy50g4().s[2]++,require('share-my-spot-errors'));const{compare}=(cov_sgsuy50g4().s[3]++,require('bcryptjs'));/**
 * Checks user credentials against the storage
 * 
 * @param {string} email user's unique e-mail
 * @param {string} password user's password
 * 
 * @returns {Promise<string>} user id from storage
 * 
 * @throws {ContentError} if user data does not follow the format and content rules
 * @throws {TypeError} if user data does not have the correct type
 * @throws {NotAllowedError} on wrong credentials
 */cov_sgsuy50g4().s[4]++;module.exports=(email,password)=>{cov_sgsuy50g4().f[0]++;cov_sgsuy50g4().s[5]++;validate.string(email,'email');cov_sgsuy50g4().s[6]++;validate.email(email);cov_sgsuy50g4().s[7]++;validate.string(password,'password');cov_sgsuy50g4().s[8]++;return(async()=>{cov_sgsuy50g4().f[1]++;const user=(cov_sgsuy50g4().s[9]++,await User.findOne({email}));cov_sgsuy50g4().s[10]++;if(!user){cov_sgsuy50g4().b[0][0]++;cov_sgsuy50g4().s[11]++;throw new NotAllowedError('wrong credentials');}else{cov_sgsuy50g4().b[0][1]++;}const validPassword=(cov_sgsuy50g4().s[12]++,await compare(password,user.password));cov_sgsuy50g4().s[13]++;if(!validPassword){cov_sgsuy50g4().b[1][0]++;cov_sgsuy50g4().s[14]++;throw new NotAllowedError('wrong credentials');}else{cov_sgsuy50g4().b[1][1]++;}cov_sgsuy50g4().s[15]++;user.authenticated=await new Date();const{id}=(cov_sgsuy50g4().s[16]++,await user.save());cov_sgsuy50g4().s[17]++;return id;})();};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGhlbnRpY2F0ZS11c2VyLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIlVzZXIiLCJOb3RBbGxvd2VkRXJyb3IiLCJjb21wYXJlIiwibW9kdWxlIiwiZXhwb3J0cyIsImVtYWlsIiwicGFzc3dvcmQiLCJzdHJpbmciLCJ1c2VyIiwiZmluZE9uZSIsInZhbGlkUGFzc3dvcmQiLCJhdXRoZW50aWNhdGVkIiwiRGF0ZSIsImlkIiwic2F2ZSJdLCJtYXBwaW5ncyI6IjJvRkFBQSxLQUFNLENBQUVBLFFBQUYsMEJBQWVDLE9BQU8sQ0FBQyxxQkFBRCxDQUF0QixDQUFOLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsSUFBRixDQUFWLDBCQUF1QkYsT0FBTyxDQUFDLG9CQUFELENBQTlCLENBQU4sQ0FDQSxLQUFNLENBQUVHLGVBQUYsMEJBQXNCSCxPQUFPLENBQUMsc0JBQUQsQ0FBN0IsQ0FBTixDQUNBLEtBQU0sQ0FBRUksT0FBRiwwQkFBY0osT0FBTyxDQUFDLFVBQUQsQ0FBckIsQ0FBTixDQUVBOzs7Ozs7Ozs7OzswQkFhQUssTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLEtBQUQsQ0FBUUMsUUFBUixHQUFxQiwrQ0FDbENULFFBQVEsQ0FBQ1UsTUFBVCxDQUFnQkYsS0FBaEIsQ0FBdUIsT0FBdkIsRUFEa0MsdUJBRWxDUixRQUFRLENBQUNRLEtBQVQsQ0FBZUEsS0FBZixFQUZrQyx1QkFHbENSLFFBQVEsQ0FBQ1UsTUFBVCxDQUFnQkQsUUFBaEIsQ0FBMEIsVUFBMUIsRUFIa0MsdUJBS2xDLE1BQU8sQ0FBQyxTQUFXLHdCQUNmLEtBQU1FLENBQUFBLElBQUkseUJBQUcsS0FBTVIsQ0FBQUEsSUFBSSxDQUFDUyxPQUFMLENBQWEsQ0FBRUosS0FBRixDQUFiLENBQVQsQ0FBVixDQURlLHdCQUdmLEdBQUksQ0FBQ0csSUFBTCxDQUFXLHdEQUFNLElBQUlQLENBQUFBLGVBQUosQ0FBb0IsbUJBQXBCLENBQU4sQ0FBOEMsQ0FBekQsZ0NBRUEsS0FBTVMsQ0FBQUEsYUFBYSwwQkFBRyxLQUFNUixDQUFBQSxPQUFPLENBQUNJLFFBQUQsQ0FBV0UsSUFBSSxDQUFDRixRQUFoQixDQUFoQixDQUFuQixDQUxlLHdCQU9mLEdBQUksQ0FBQ0ksYUFBTCxDQUFvQix3REFBTSxJQUFJVCxDQUFBQSxlQUFKLENBQW9CLG1CQUFwQixDQUFOLENBQThDLENBQWxFLGdDQVBlLHdCQVNmTyxJQUFJLENBQUNHLGFBQUwsQ0FBcUIsS0FBTSxJQUFJQyxDQUFBQSxJQUFKLEVBQTNCLENBRUEsS0FBTSxDQUFFQyxFQUFGLDJCQUFTLEtBQU1MLENBQUFBLElBQUksQ0FBQ00sSUFBTCxFQUFmLENBQU4sQ0FYZSx3QkFhZixNQUFPRCxDQUFBQSxFQUFQLENBQ0gsQ0FkTSxHQUFQLENBZUgsQ0FwQkQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHZhbGlkYXRlIH0gPSByZXF1aXJlKCdzaGFyZS1teS1zcG90LXV0aWxzJylcbmNvbnN0IHsgbW9kZWxzOiB7IFVzZXIgfSB9ID0gcmVxdWlyZSgnc2hhcmUtbXktc3BvdC1kYXRhJylcbmNvbnN0IHsgTm90QWxsb3dlZEVycm9yIH0gPSByZXF1aXJlKCdzaGFyZS1teS1zcG90LWVycm9ycycpXG5jb25zdCB7IGNvbXBhcmUgfSA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcblxuLyoqXG4gKiBDaGVja3MgdXNlciBjcmVkZW50aWFscyBhZ2FpbnN0IHRoZSBzdG9yYWdlXG4gKiBcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbWFpbCB1c2VyJ3MgdW5pcXVlIGUtbWFpbFxuICogQHBhcmFtIHtzdHJpbmd9IHBhc3N3b3JkIHVzZXIncyBwYXNzd29yZFxuICogXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSB1c2VyIGlkIGZyb20gc3RvcmFnZVxuICogXG4gKiBAdGhyb3dzIHtDb250ZW50RXJyb3J9IGlmIHVzZXIgZGF0YSBkb2VzIG5vdCBmb2xsb3cgdGhlIGZvcm1hdCBhbmQgY29udGVudCBydWxlc1xuICogQHRocm93cyB7VHlwZUVycm9yfSBpZiB1c2VyIGRhdGEgZG9lcyBub3QgaGF2ZSB0aGUgY29ycmVjdCB0eXBlXG4gKiBAdGhyb3dzIHtOb3RBbGxvd2VkRXJyb3J9IG9uIHdyb25nIGNyZWRlbnRpYWxzXG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSAoZW1haWwsIHBhc3N3b3JkKSA9PiB7XG4gICAgdmFsaWRhdGUuc3RyaW5nKGVtYWlsLCAnZW1haWwnKVxuICAgIHZhbGlkYXRlLmVtYWlsKGVtYWlsKVxuICAgIHZhbGlkYXRlLnN0cmluZyhwYXNzd29yZCwgJ3Bhc3N3b3JkJylcblxuICAgIHJldHVybiAoYXN5bmMoKSA9PiB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyBlbWFpbCB9KVxuICAgIFxuICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBOb3RBbGxvd2VkRXJyb3IoJ3dyb25nIGNyZWRlbnRpYWxzJylcbiAgICBcbiAgICAgICAgY29uc3QgdmFsaWRQYXNzd29yZCA9IGF3YWl0IGNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpXG4gICAgXG4gICAgICAgIGlmICghdmFsaWRQYXNzd29yZCkgdGhyb3cgbmV3IE5vdEFsbG93ZWRFcnJvcignd3JvbmcgY3JlZGVudGlhbHMnKVxuICAgIFxuICAgICAgICB1c2VyLmF1dGhlbnRpY2F0ZWQgPSBhd2FpdCBuZXcgRGF0ZVxuICAgIFxuICAgICAgICBjb25zdCB7IGlkIH0gPSBhd2FpdCB1c2VyLnNhdmUoKVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGlkXG4gICAgfSkoKVxufSJdfQ==