function cov_yq23lsgki(){var path="/Users/federicolacabaratz/bootcamp/collab/skylab-bootcamp-202001/staff/federico-lacabaratz/share-my-spot/share-my-spot-api/logic/delete-spot.js";var hash="5913fd7af52ce5738b9b8476430951765473344c";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/federicolacabaratz/bootcamp/collab/skylab-bootcamp-202001/staff/federico-lacabaratz/share-my-spot/share-my-spot-api/logic/delete-spot.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:51}},"1":{start:{line:2,column:35},end:{line:2,column:64}},"2":{start:{line:3,column:28},end:{line:3,column:59}},"3":{start:{line:5,column:0},end:{line:24,column:1}},"4":{start:{line:6,column:4},end:{line:6,column:37}},"5":{start:{line:7,column:4},end:{line:7,column:37}},"6":{start:{line:9,column:4},end:{line:23,column:24}},"7":{start:{line:11,column:12},end:{line:17,column:13}},"8":{start:{line:11,column:24},end:{line:11,column:85}},"9":{start:{line:13,column:19},end:{line:17,column:13}},"10":{start:{line:14,column:16},end:{line:14,column:78}},"11":{start:{line:16,column:16},end:{line:16,column:60}},"12":{start:{line:20,column:12},end:{line:20,column:129}},"13":{start:{line:20,column:52},end:{line:20,column:128}},"14":{start:{line:22,column:20},end:{line:22,column:50}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:17},end:{line:5,column:18}},loc:{start:{line:5,column:37},end:{line:24,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:10,column:10},end:{line:10,column:11}},loc:{start:{line:10,column:18},end:{line:18,column:9}},line:10},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:14},end:{line:19,column:15}},loc:{start:{line:19,column:28},end:{line:21,column:9}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:20,column:38},end:{line:20,column:39}},loc:{start:{line:20,column:52},end:{line:20,column:128}},line:20},"4":{name:"(anonymous_4)",decl:{start:{line:22,column:14},end:{line:22,column:15}},loc:{start:{line:22,column:20},end:{line:22,column:50}},line:22},"5":{name:"(anonymous_5)",decl:{start:{line:23,column:14},end:{line:23,column:15}},loc:{start:{line:23,column:20},end:{line:23,column:23}},line:23}},branchMap:{"0":{loc:{start:{line:11,column:12},end:{line:17,column:13}},type:"if",locations:[{start:{line:11,column:12},end:{line:17,column:13}},{start:{line:11,column:12},end:{line:17,column:13}}],line:11},"1":{loc:{start:{line:13,column:19},end:{line:17,column:13}},type:"if",locations:[{start:{line:13,column:19},end:{line:17,column:13}},{start:{line:13,column:19},end:{line:17,column:13}}],line:13}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"5913fd7af52ce5738b9b8476430951765473344c"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_yq23lsgki=function(){return actualCoverage;};return actualCoverage;}cov_yq23lsgki();const{validate}=(cov_yq23lsgki().s[0]++,require('share-my-spot-utils'));const{models:{Spot,User}}=(cov_yq23lsgki().s[1]++,require('share-my-spot-data'));const{NotAllowedError}=(cov_yq23lsgki().s[2]++,require('share-my-spot-errors'));cov_yq23lsgki().s[3]++;module.exports=(userId,spotId)=>{cov_yq23lsgki().f[0]++;cov_yq23lsgki().s[4]++;validate.string(userId,'userId');cov_yq23lsgki().s[5]++;validate.string(spotId,'spotId');cov_yq23lsgki().s[6]++;return User.findOne({_id:userId,publishedSpots:spotId}).then(user=>{cov_yq23lsgki().f[1]++;cov_yq23lsgki().s[7]++;if(!user){cov_yq23lsgki().b[0][0]++;cov_yq23lsgki().s[8]++;throw new NotFoundError(`user with id ${_id} does not exist`);}else{cov_yq23lsgki().b[0][1]++;cov_yq23lsgki().s[9]++;if(!user.publishedSpots.includes(spotId)){cov_yq23lsgki().b[1][0]++;cov_yq23lsgki().s[10]++;throw new NotAllowedError('This user cannot delete this spot');}else{cov_yq23lsgki().b[1][1]++;cov_yq23lsgki().s[11]++;return User.find({publishedSpots:spotId});}}}).then(usersArray=>{cov_yq23lsgki().f[2]++;cov_yq23lsgki().s[12]++;return usersArray.forEach(async user=>{cov_yq23lsgki().f[3]++;cov_yq23lsgki().s[13]++;return await User.findByIdAndUpdate(user.id,{$pull:{publishedSpots:spotId}});});}).then(()=>{cov_yq23lsgki().f[4]++;cov_yq23lsgki().s[14]++;return Spot.findByIdAndRemove(spotId);}).then(()=>{cov_yq23lsgki().f[5]++;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlbGV0ZS1zcG90LmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIlNwb3QiLCJVc2VyIiwiTm90QWxsb3dlZEVycm9yIiwibW9kdWxlIiwiZXhwb3J0cyIsInVzZXJJZCIsInNwb3RJZCIsInN0cmluZyIsImZpbmRPbmUiLCJfaWQiLCJwdWJsaXNoZWRTcG90cyIsInRoZW4iLCJ1c2VyIiwiTm90Rm91bmRFcnJvciIsImluY2x1ZGVzIiwiZmluZCIsInVzZXJzQXJyYXkiLCJmb3JFYWNoIiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJpZCIsIiRwdWxsIiwiZmluZEJ5SWRBbmRSZW1vdmUiXSwibWFwcGluZ3MiOiI2aUdBQUEsS0FBTSxDQUFFQSxRQUFGLDBCQUFlQyxPQUFPLENBQUMscUJBQUQsQ0FBdEIsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBUUMsSUFBUixDQUFWLDBCQUE2QkgsT0FBTyxDQUFDLG9CQUFELENBQXBDLENBQU4sQ0FDQSxLQUFNLENBQUVJLGVBQUYsMEJBQXNCSixPQUFPLENBQUMsc0JBQUQsQ0FBN0IsQ0FBTixDLHVCQUVBSyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsTUFBRCxDQUFTQyxNQUFULEdBQW9CLCtDQUNqQ1QsUUFBUSxDQUFDVSxNQUFULENBQWdCRixNQUFoQixDQUF3QixRQUF4QixFQURpQyx1QkFFakNSLFFBQVEsQ0FBQ1UsTUFBVCxDQUFnQkQsTUFBaEIsQ0FBd0IsUUFBeEIsRUFGaUMsdUJBSWpDLE1BQU9MLENBQUFBLElBQUksQ0FBQ08sT0FBTCxDQUFhLENBQUVDLEdBQUcsQ0FBRUosTUFBUCxDQUFlSyxjQUFjLENBQUVKLE1BQS9CLENBQWIsRUFDTkssSUFETSxDQUNEQyxJQUFJLEVBQUksK0NBQ04sR0FBSSxDQUFDQSxJQUFMLENBQVcsa0RBQUMsS0FBTSxJQUFJQyxDQUFBQSxhQUFKLENBQW1CLGdCQUFlSixHQUFJLGlCQUF0QyxDQUFOLENBRVgsQ0FGRCxJQUVPLHFEQUFJLENBQUNHLElBQUksQ0FBQ0YsY0FBTCxDQUFvQkksUUFBcEIsQ0FBNkJSLE1BQTdCLENBQUwsQ0FBMkMsbURBQzlDLEtBQU0sSUFBSUosQ0FBQUEsZUFBSixDQUFvQixtQ0FBcEIsQ0FBTixDQUNILENBRk0sSUFFQSxtREFDSCxNQUFPRCxDQUFBQSxJQUFJLENBQUNjLElBQUwsQ0FBVSxDQUFFTCxjQUFjLENBQUVKLE1BQWxCLENBQVYsQ0FBUCxDQUNILEVBQ0osQ0FURSxFQVVGSyxJQVZFLENBVUdLLFVBQVUsRUFBSSxnREFDaEIsTUFBT0EsQ0FBQUEsVUFBVSxDQUFDQyxPQUFYLENBQW1CLEtBQU1MLENBQUFBLElBQU4sRUFBYyw0REFBTVgsQ0FBQUEsSUFBSSxDQUFDaUIsaUJBQUwsQ0FBdUJOLElBQUksQ0FBQ08sRUFBNUIsQ0FBZ0MsQ0FBRUMsS0FBSyxDQUFFLENBQUVWLGNBQWMsQ0FBRUosTUFBbEIsQ0FBVCxDQUFoQyxDQUFOLENBQTRFLENBQTdHLENBQVAsQ0FDSCxDQVpFLEVBYUZLLElBYkUsQ0FhRyxJQUFNLHNEQUFBWCxDQUFBQSxJQUFJLENBQUNxQixpQkFBTCxDQUF1QmYsTUFBdkIsRUFBOEIsQ0FidkMsRUFjRkssSUFkRSxDQWNHLElBQU0sd0JBQUcsQ0FkWixDQUFQLENBZUgsQ0FuQkQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHZhbGlkYXRlIH0gPSByZXF1aXJlKCdzaGFyZS1teS1zcG90LXV0aWxzJylcbmNvbnN0IHsgbW9kZWxzOiB7IFNwb3QsIFVzZXIgfSB9ID0gcmVxdWlyZSgnc2hhcmUtbXktc3BvdC1kYXRhJylcbmNvbnN0IHsgTm90QWxsb3dlZEVycm9yIH0gPSByZXF1aXJlKCdzaGFyZS1teS1zcG90LWVycm9ycycpXG5cbm1vZHVsZS5leHBvcnRzID0gKHVzZXJJZCwgc3BvdElkKSA9PiB7XG4gICAgdmFsaWRhdGUuc3RyaW5nKHVzZXJJZCwgJ3VzZXJJZCcpXG4gICAgdmFsaWRhdGUuc3RyaW5nKHNwb3RJZCwgJ3Nwb3RJZCcpXG5cbiAgICByZXR1cm4gVXNlci5maW5kT25lKHsgX2lkOiB1c2VySWQsIHB1Ymxpc2hlZFNwb3RzOiBzcG90SWQgfSlcbiAgICAudGhlbih1c2VyID0+IHtcbiAgICAgICAgICAgIGlmICghdXNlcikge3Rocm93IG5ldyBOb3RGb3VuZEVycm9yKGB1c2VyIHdpdGggaWQgJHtfaWR9IGRvZXMgbm90IGV4aXN0YClcblxuICAgICAgICAgICAgfSBlbHNlIGlmICghdXNlci5wdWJsaXNoZWRTcG90cy5pbmNsdWRlcyhzcG90SWQpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdEFsbG93ZWRFcnJvcignVGhpcyB1c2VyIGNhbm5vdCBkZWxldGUgdGhpcyBzcG90JykgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBVc2VyLmZpbmQoeyBwdWJsaXNoZWRTcG90czogc3BvdElkIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKHVzZXJzQXJyYXkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHVzZXJzQXJyYXkuZm9yRWFjaChhc3luYyB1c2VyID0+IGF3YWl0IFVzZXIuZmluZEJ5SWRBbmRVcGRhdGUodXNlci5pZCwgeyAkcHVsbDogeyBwdWJsaXNoZWRTcG90czogc3BvdElkIH0gfSkpXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKCgpID0+IFNwb3QuZmluZEJ5SWRBbmRSZW1vdmUoc3BvdElkKSlcbiAgICAgICAgLnRoZW4oKCkgPT4geyB9KVxufSJdfQ==