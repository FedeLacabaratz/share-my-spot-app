function cov_1qcj8rfx54(){var path="/Users/federicolacabaratz/bootcamp/collab/skylab-bootcamp-202001/staff/federico-lacabaratz/share-my-spot/share-my-spot-api/logic/register-user.js";var hash="a106d87c93cfaa61e04b928b3c28994a6923a0f9";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/federicolacabaratz/bootcamp/collab/skylab-bootcamp-202001/staff/federico-lacabaratz/share-my-spot/share-my-spot-api/logic/register-user.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:51}},"1":{start:{line:2,column:29},end:{line:2,column:58}},"2":{start:{line:3,column:28},end:{line:3,column:59}},"3":{start:{line:4,column:15},end:{line:4,column:34}},"4":{start:{line:20,column:0},end:{line:40,column:1}},"5":{start:{line:21,column:4},end:{line:21,column:33}},"6":{start:{line:22,column:4},end:{line:22,column:39}},"7":{start:{line:23,column:4},end:{line:23,column:35}},"8":{start:{line:24,column:4},end:{line:24,column:25}},"9":{start:{line:25,column:4},end:{line:25,column:41}},"10":{start:{line:26,column:4},end:{line:26,column:41}},"11":{start:{line:28,column:4},end:{line:39,column:24}},"12":{start:{line:30,column:12},end:{line:30,column:90}},"13":{start:{line:30,column:22},end:{line:30,column:90}},"14":{start:{line:32,column:12},end:{line:32,column:44}},"15":{start:{line:35,column:12},end:{line:35,column:89}},"16":{start:{line:37,column:12},end:{line:37,column:30}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:20,column:17},end:{line:20,column:18}},loc:{start:{line:20,column:60},end:{line:40,column:1}},line:20},"1":{name:"(anonymous_1)",decl:{start:{line:29,column:14},end:{line:29,column:15}},loc:{start:{line:29,column:22},end:{line:33,column:9}},line:29},"2":{name:"(anonymous_2)",decl:{start:{line:34,column:14},end:{line:34,column:15}},loc:{start:{line:34,column:26},end:{line:38,column:9}},line:34},"3":{name:"(anonymous_3)",decl:{start:{line:39,column:14},end:{line:39,column:15}},loc:{start:{line:39,column:20},end:{line:39,column:23}},line:39}},branchMap:{"0":{loc:{start:{line:30,column:12},end:{line:30,column:90}},type:"if",locations:[{start:{line:30,column:12},end:{line:30,column:90}},{start:{line:30,column:12},end:{line:30,column:90}}],line:30}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"a106d87c93cfaa61e04b928b3c28994a6923a0f9"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1qcj8rfx54=function(){return actualCoverage;};return actualCoverage;}cov_1qcj8rfx54();const{validate}=(cov_1qcj8rfx54().s[0]++,require('share-my-spot-utils'));const{models:{User}}=(cov_1qcj8rfx54().s[1]++,require('share-my-spot-data'));const{NotAllowedError}=(cov_1qcj8rfx54().s[2]++,require('share-my-spot-errors'));const bcrypt=(cov_1qcj8rfx54().s[3]++,require('bcryptjs'));/**
 * Registers a new user within the database
 * 
 * @param {string} name user's unique name
 * @param {string} surname user's unique surname
 * @param {string} email user's unique e-mail
 * @param {number} phone user's unique phone number
 * @param {string} password user's password
 * 
 * @returns {Promise<string>} returns an empty Promise on a successful registry
 * 
 * @throws {NotAllowedError} when the typed email has already been taken
 */cov_1qcj8rfx54().s[4]++;module.exports=(name,surname,email,phone,password)=>{cov_1qcj8rfx54().f[0]++;cov_1qcj8rfx54().s[5]++;validate.string(name,'name');cov_1qcj8rfx54().s[6]++;validate.string(surname,'surname');cov_1qcj8rfx54().s[7]++;validate.string(email,'email');cov_1qcj8rfx54().s[8]++;validate.email(email);cov_1qcj8rfx54().s[9]++;validate.type(phone,'phone',Number);cov_1qcj8rfx54().s[10]++;validate.string(password,'password');cov_1qcj8rfx54().s[11]++;return User.findOne({email}).then(user=>{cov_1qcj8rfx54().f[1]++;cov_1qcj8rfx54().s[12]++;if(user){cov_1qcj8rfx54().b[0][0]++;cov_1qcj8rfx54().s[13]++;throw new NotAllowedError(`user with email ${email} already exists`);}else{cov_1qcj8rfx54().b[0][1]++;}cov_1qcj8rfx54().s[14]++;return bcrypt.hash(password,10);}).then(password=>{cov_1qcj8rfx54().f[2]++;cov_1qcj8rfx54().s[15]++;user=new User({name,surname,email,phone,password,created:new Date()});cov_1qcj8rfx54().s[16]++;return user.save();}).then(()=>{cov_1qcj8rfx54().f[3]++;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyLXVzZXIuanMiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJyZXF1aXJlIiwibW9kZWxzIiwiVXNlciIsIk5vdEFsbG93ZWRFcnJvciIsImJjcnlwdCIsIm1vZHVsZSIsImV4cG9ydHMiLCJuYW1lIiwic3VybmFtZSIsImVtYWlsIiwicGhvbmUiLCJwYXNzd29yZCIsInN0cmluZyIsInR5cGUiLCJOdW1iZXIiLCJmaW5kT25lIiwidGhlbiIsInVzZXIiLCJoYXNoIiwiY3JlYXRlZCIsIkRhdGUiLCJzYXZlIl0sIm1hcHBpbmdzIjoibXJGQUFBLEtBQU0sQ0FBRUEsUUFBRiwyQkFBZUMsT0FBTyxDQUFDLHFCQUFELENBQXRCLENBQU4sQ0FDQSxLQUFNLENBQUVDLE1BQU0sQ0FBRSxDQUFFQyxJQUFGLENBQVYsMkJBQXVCRixPQUFPLENBQUMsb0JBQUQsQ0FBOUIsQ0FBTixDQUNBLEtBQU0sQ0FBRUcsZUFBRiwyQkFBc0JILE9BQU8sQ0FBQyxzQkFBRCxDQUE3QixDQUFOLENBQ0EsS0FBTUksQ0FBQUEsTUFBTSwwQkFBR0osT0FBTyxDQUFDLFVBQUQsQ0FBVixDQUFaLENBRUE7Ozs7Ozs7Ozs7OzsyQkFjQUssTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLElBQUQsQ0FBT0MsT0FBUCxDQUFnQkMsS0FBaEIsQ0FBdUJDLEtBQXZCLENBQThCQyxRQUE5QixHQUEyQyxpREFDeERaLFFBQVEsQ0FBQ2EsTUFBVCxDQUFnQkwsSUFBaEIsQ0FBc0IsTUFBdEIsRUFEd0Qsd0JBRXhEUixRQUFRLENBQUNhLE1BQVQsQ0FBZ0JKLE9BQWhCLENBQXlCLFNBQXpCLEVBRndELHdCQUd4RFQsUUFBUSxDQUFDYSxNQUFULENBQWdCSCxLQUFoQixDQUF1QixPQUF2QixFQUh3RCx3QkFJeERWLFFBQVEsQ0FBQ1UsS0FBVCxDQUFlQSxLQUFmLEVBSndELHdCQUt4RFYsUUFBUSxDQUFDYyxJQUFULENBQWNILEtBQWQsQ0FBcUIsT0FBckIsQ0FBOEJJLE1BQTlCLEVBTHdELHlCQU14RGYsUUFBUSxDQUFDYSxNQUFULENBQWdCRCxRQUFoQixDQUEwQixVQUExQixFQU53RCx5QkFReEQsTUFBT1QsQ0FBQUEsSUFBSSxDQUFDYSxPQUFMLENBQWEsQ0FBRU4sS0FBRixDQUFiLEVBQ0ZPLElBREUsQ0FDR0MsSUFBSSxFQUFJLGtEQUNWLEdBQUlBLElBQUosQ0FBVSwwREFBTSxJQUFJZCxDQUFBQSxlQUFKLENBQXFCLG1CQUFrQk0sS0FBTSxpQkFBN0MsQ0FBTixDQUFvRSxDQUE5RSxpQ0FEVSx5QkFHVixNQUFPTCxDQUFBQSxNQUFNLENBQUNjLElBQVAsQ0FBWVAsUUFBWixDQUFzQixFQUF0QixDQUFQLENBQ0gsQ0FMRSxFQU1GSyxJQU5FLENBTUdMLFFBQVEsRUFBSSxrREFDZE0sSUFBSSxDQUFHLEdBQUlmLENBQUFBLElBQUosQ0FBUyxDQUFFSyxJQUFGLENBQVFDLE9BQVIsQ0FBaUJDLEtBQWpCLENBQXdCQyxLQUF4QixDQUErQkMsUUFBL0IsQ0FBeUNRLE9BQU8sQ0FBRSxHQUFJQyxDQUFBQSxJQUFKLEVBQWxELENBQVQsQ0FBUCxDQURjLHlCQUdkLE1BQU9ILENBQUFBLElBQUksQ0FBQ0ksSUFBTCxFQUFQLENBQ0gsQ0FWRSxFQVdGTCxJQVhFLENBV0csSUFBTSx5QkFBRyxDQVhaLENBQVAsQ0FZSCxDQXBCRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgdmFsaWRhdGUgfSA9IHJlcXVpcmUoJ3NoYXJlLW15LXNwb3QtdXRpbHMnKVxuY29uc3QgeyBtb2RlbHM6IHsgVXNlciB9IH0gPSByZXF1aXJlKCdzaGFyZS1teS1zcG90LWRhdGEnKVxuY29uc3QgeyBOb3RBbGxvd2VkRXJyb3IgfSA9IHJlcXVpcmUoJ3NoYXJlLW15LXNwb3QtZXJyb3JzJylcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJylcblxuLyoqXG4gKiBSZWdpc3RlcnMgYSBuZXcgdXNlciB3aXRoaW4gdGhlIGRhdGFiYXNlXG4gKiBcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIHVzZXIncyB1bmlxdWUgbmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHN1cm5hbWUgdXNlcidzIHVuaXF1ZSBzdXJuYW1lXG4gKiBAcGFyYW0ge3N0cmluZ30gZW1haWwgdXNlcidzIHVuaXF1ZSBlLW1haWxcbiAqIEBwYXJhbSB7bnVtYmVyfSBwaG9uZSB1c2VyJ3MgdW5pcXVlIHBob25lIG51bWJlclxuICogQHBhcmFtIHtzdHJpbmd9IHBhc3N3b3JkIHVzZXIncyBwYXNzd29yZFxuICogXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxzdHJpbmc+fSByZXR1cm5zIGFuIGVtcHR5IFByb21pc2Ugb24gYSBzdWNjZXNzZnVsIHJlZ2lzdHJ5XG4gKiBcbiAqIEB0aHJvd3Mge05vdEFsbG93ZWRFcnJvcn0gd2hlbiB0aGUgdHlwZWQgZW1haWwgaGFzIGFscmVhZHkgYmVlbiB0YWtlblxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gKG5hbWUsIHN1cm5hbWUsIGVtYWlsLCBwaG9uZSwgcGFzc3dvcmQpID0+IHtcbiAgICB2YWxpZGF0ZS5zdHJpbmcobmFtZSwgJ25hbWUnKVxuICAgIHZhbGlkYXRlLnN0cmluZyhzdXJuYW1lLCAnc3VybmFtZScpXG4gICAgdmFsaWRhdGUuc3RyaW5nKGVtYWlsLCAnZW1haWwnKVxuICAgIHZhbGlkYXRlLmVtYWlsKGVtYWlsKVxuICAgIHZhbGlkYXRlLnR5cGUocGhvbmUsICdwaG9uZScsIE51bWJlcilcbiAgICB2YWxpZGF0ZS5zdHJpbmcocGFzc3dvcmQsICdwYXNzd29yZCcpXG5cbiAgICByZXR1cm4gVXNlci5maW5kT25lKHsgZW1haWwgfSlcbiAgICAgICAgLnRoZW4odXNlciA9PiB7XG4gICAgICAgICAgICBpZiAodXNlcikgdGhyb3cgbmV3IE5vdEFsbG93ZWRFcnJvcihgdXNlciB3aXRoIGVtYWlsICR7ZW1haWx9IGFscmVhZHkgZXhpc3RzYClcblxuICAgICAgICAgICAgcmV0dXJuIGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMClcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4ocGFzc3dvcmQgPT4ge1xuICAgICAgICAgICAgdXNlciA9IG5ldyBVc2VyKHsgbmFtZSwgc3VybmFtZSwgZW1haWwsIHBob25lLCBwYXNzd29yZCwgY3JlYXRlZDogbmV3IERhdGUgfSlcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIHVzZXIuc2F2ZSgpXG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKCgpID0+IHsgfSlcbn0iXX0=